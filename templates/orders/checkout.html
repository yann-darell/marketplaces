{% extends 'base.html' %}
{% load math_filters %}

{% block title %}Passer Commande - MarketElite{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-4">
    <h1 class="text-gradient mb-2">
        <i class="fas fa-credit-card"></i> Validation de Commande
    </h1>
    <p class="text-muted">Veuillez confirmer les détails de votre commande</p>
</div>

<div class="row">
    <!-- Checkout Form Column -->
    <div class="col-lg-8 mb-4">
        <div class="card shadow-lg">
            <div class="card-header bg-gradient text-white">
                <h5 class="mb-0">
                    <i class="fas fa-box"></i> Récapitulatif de votre commande
                </h5>
            </div>

            <!-- Order Summary Table -->
            <div class="card-body">
                <div class="table-responsive mb-4">
                    <table class="table table-sm table-hover">
                        <thead class="table-light">
                            <tr>
                                <th><i class="fas fa-tag"></i> Produit</th>
                                <th class="text-center">Prix</th>
                                <th class="text-center">Quantité</th>
                                <th class="text-end">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in cart_items %}
                                <tr>
                                    <td>
                                        <strong>{{ item.product.title }}</strong>
                                        <br>
                                        <small class="text-muted">{{ item.product.seller.get_full_name|default:item.product.seller.username }}</small>
                                    </td>
                                    <td class="text-center">{{ item.product.price }} FCFA</td>
                                    <td class="text-center">
                                        <span class="badge bg-secondary">{{ item.quantity }}</span>
                                    </td>
                                    <td class="text-end">
                                        <strong>{{ item.product.price|add:0|mul:item.quantity }} FCFA</strong>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Checkout Form -->
            <div class="card-body border-top">
                <form method="post">
                    {% csrf_token %}

                    <!-- Payment Method -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-wallet"></i> Méthode de Paiement
                        </label>
                        <div class="card-group">
                            {% for choice in form.payment_method %}
                                <div class="form-check">
                                    {{ choice.tag }}
                                    <label class="form-check-label ms-2">
                                        {{ choice.choice_label }}
                                    </label>
                                </div>
                            {% endfor %}
                        </div>
                        {% if form.payment_method.errors %}
                            <div class="alert alert-danger mt-2">
                                {{ form.payment_method.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Delivery Address -->
                    <div class="mb-3">
                        <label for="{{ form.delivery_address.id_for_label }}" class="form-label fw-bold">
                            <i class="fas fa-map-marker-alt"></i> Adresse de Livraison
                        </label>
                        {{ form.delivery_address }}
                        {% if form.delivery_address.errors %}
                            <div class="alert alert-danger mt-2">
                                {{ form.delivery_address.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Phone Number -->
                    <div class="mb-4">
                        <label for="{{ form.phone_number.id_for_label }}" class="form-label fw-bold">
                            <i class="fas fa-phone"></i> Numéro de Téléphone
                        </label>
                        {{ form.phone_number }}
                        {% if form.phone_number.errors %}
                            <div class="alert alert-danger mt-2">
                                {{ form.phone_number.errors }}
                            </div>
                        {% endif %}
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="fas fa-check-circle"></i> Confirmer la Commande
                    </button>
                </form>
            </div>
        </div>

        <!-- Continue Shopping Link -->
        <div class="mt-3">
            <a href="{% url 'product_list' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Continuer les achats
            </a>
        </div>
    </div>

    <!-- Order Summary Card -->
    <div class="col-lg-4">
        <div class="card shadow-lg sticky-top" style="top: 80px;">
            <div class="card-header bg-gradient text-white">
                <h5 class="mb-0">
                    <i class="fas fa-receipt"></i> Résumé de Commande
                </h5>
            </div>
            <div class="card-body">
                <!-- Items Count -->
                <div class="d-flex justify-content-between mb-3">
                    <span class="text-muted">
                        <i class="fas fa-box"></i> Nombre d'articles:
                    </span>
                    <strong>{{ cart_items|length }}</strong>
                </div>

                <!-- Subtotal -->
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Sous-total:</span>
                    <strong>{{ total }} FCFA</strong>
                </div>

                <!-- Delivery Estimate -->
                <div class="d-flex justify-content-between mb-3 text-muted">
                    <span><i class="fas fa-truck"></i> Livraison:</span>
                    <span>À confirmer</span>
                </div>

                <hr>

                <!-- Total -->
                <div class="d-flex justify-content-between mb-4">
                    <h5 class="mb-0">Total:</h5>
                    <h5 class="text-gradient mb-0">{{ total }} FCFA</h5>
                </div>

                <!-- Security Notice -->
                <div class="alert alert-success border-0 small">
                    <i class="fas fa-lock"></i> <strong>Paiement Sécurisé</strong>
                    <p class="mb-0">Vos données sont protégées.</p>
                </div>

                <!-- Info Box -->
                <div class="alert alert-info border-0 small">
                    <i class="fas fa-info-circle"></i>
                    <strong>Confirmation:</strong> Vous recevrez un email de confirmation après validation.
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .text-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .bg-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    }

    .form-check-input {
        margin-top: 0.3rem;
    }

    .card-group {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
</style>
{% endblock %}
